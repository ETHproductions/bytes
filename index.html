<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
    <title>bytes - The all-in-one online byte counter</title>
    <link rel="stylesheet" type="text/css" href="../style/style.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <style>
      * {
        background-color: transparent;
        font-family: Open Sans;
      }
      html {
        background-color: #BEB;
      }
      #bg {
        position: absolute;
        width: 66%;
        margin-left: 17%;
        margin-top: -10px;
        height: 3000px;
        max-height: 100%;
        background-color: #F8FFF8;
        z-index: -1;
      }
      #fg {
        position: absolute;
        width: 50%;
        margin-left: 25%;
      }
      textarea {
        margin-left: 0px;
        margin-right: 0px;
        width: 100%;
        border-radius: 0px;
        font-family: Monaco, Consolas, monospace;
        background-color: #E9FFE9;
      }
      h1 {
        font-family: Monaco, Consolas, monospace;
        text-align: center;
      }
      h4 {
        text-align: center;
      }
      th {
        margin-left: 8px;
        text-align: left;
      }
      td {
        margin-left: 8px;
        font-family: Monaco, Consolas, monospace;
      }
      #link {
        text-decoration: underline;
        cursor: pointer;
      }
    </style>
    <script>
      var encodings = [, "UTF-8", "UTF-16", "ISO-8859-1", "UTF-32"],
          encodingRegex = [/^0$/, /utf-?8/i, /utf-?16/i, /iso-?8859(?:-1)?/i, /utf-?32/i];
      function update() { setTimeout(function(){
        var text = document.getElementById("text").value,
            encoding = document.getElementById("encoding").value,
            bytes = 0,
            chars = (text.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^]/g)||[]).length,
            valid = true;
        if (encoding == "chars")
          return document.getElementById("bytes").innerHTML = "That's <b>" + chars + "</b> chars.";
        else if (encoding == "utf-8")
          bytes = text.replace(/([\uD800-\uDBFF][\uDC00-\uDFFF])|[^]/g,function(x,y){return y?"xxxx":x.charCodeAt(0)>=0x0800?"xxx":x.charCodeAt(0)>=0x0080?"xx":"x"}).length;
        else if (encoding == "utf-16")
          bytes = text.length * 2;
        else if (encoding == "utf-32")
          bytes = chars * 4;
        else if (encoding == "iso-8859-1")
          bytes = text.length, valid = /^[\x00-\xff]*$/.test(text);
        document.getElementById("bytes").innerHTML = "That's <b>" + chars + "</b> chars, " + (valid ? "totaling <b>" + bytes + "</b> " + encoding.toUpperCase() + " bytes." : " but invalid " + encoding.toUpperCase() + ".");
      },10); }
      function link() {
        window.history.pushState('', 'bytes - The all-in-one online byte counter',
          '/bytes/?e=' + document.getElementById('encoding').value
          + '\&t=' + encodeURIComponent(document.getElementById('text').value))
      }
    </script>
  </head>
  
  <body>
    <div id="bg"></div>
    <div id="fg">
      <h1>bytes</h1>
      <h4>The all-in-one online byte counter.</h4>
      <textarea rows=8 id="text" oninput="update()">I â™¥ bytes</textarea>

      <p><span id="bytes"></span>&nbsp;<a id="link" onclick="link()">Permalink</a></p>

      Choose a different encoding:
      <select id="encoding" onclick="update()">
        <option value="utf-8" selected>UTF-8</option>
        <option value="utf-16">UTF-16</option>
        <option value="iso-8859-1">ISO-8859-1</option>
        <option value="chars">--------</option>
        <option value="utf-32">UTF-32</option>
      </select>
      
      <p>Here's a bookmarklet to count UTF-8 bytes on the fly: <a href='javascript:(function(){var%20d=document,e=d.activeElement;alert((String(d.getSelection())||("selectionStart"in%20e?e.value.slice(e.selectionStart,e.selectionEnd):"")).replace(/([\uD800-\uDBFF][\uDC00-\uDFFF])|[^]/g,function(x,y){return%20y?"xxxx":x.charCodeAt(0)>=0x0800?"xxx":x.charCodeAt(0)>=0x0080?"xx":"x"}).length+"%20UTF-8%20bytes")})()'>Count UTF-8 bytes</a></p>
      
      <!--
      <h3>Encoding info</h3>
      <div id="tab-1">
        <table>
          <tr><th>code points</th><th>bytes</th><th>bit format</th></tr>
          <tr><td>000000-00007F</td><td>1</td><td>0xxxxxxx</td></tr>
          <tr><td>000080-0007FF</td><td>2</td><td>110xxxxx 10xxxxxx</td></tr>
          <tr><td>000800-00FFFF</td><td>3</td><td>1110xxxx 10xxxxxx 10xxxxxx</td></tr>
          <tr><td>010000-10FFFF</td><td>4</td><td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr>
        </table>
      </div>
      -->
      
      <script>
        if (/e=\d+(?=&|$)/.test(location.search)) document.getElementById('encoding').value = [, "utf-8", "utf-16", "iso-8859-1", "utf-32"][location.search.match(/e=(\d+)/)[1]] || "chars";
        else if (/e=[^&]+/.test(location.search)) document.getElementById('encoding').value = encodingRegex.reduce(function (x, y, i) { return ((typeof x === "string") && y.test(x)) ? encodings[i].toLowerCase() : x; }, location.search.match(/e=([^&]+)/)[1]);
        if (/t=.+/.test(location.search)) document.getElementById('text').value = decodeURIComponent(location.search.match(/t=([^&]+)/)[1]);
        update();
      </script>
    </div>
  </body>
</html>
